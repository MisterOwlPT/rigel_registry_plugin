image:
  name: docker:git

services:
  - docker:18.09.7-dind

stages:
  - release

release_job:
  stage: release
  only:
    - tags
  before_script:
    - apk update && apk add --no-cache build-base cargo gcc libffi-dev libressl-dev musl-dev openssl-dev python3 python3-dev py3-pip
    - pip3 install poetry
  script:
    - poetry build
    - poetry config repositories.gitlab ${CI_REPOSITORY_URL}
    - poetry publish --repository gitlab -u ${CI_USER} -p ${CI_PASSWORD}
